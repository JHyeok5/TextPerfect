const CACHE_NAME="textperfect-v1",API_CACHE="textperfect-api-v1",STATIC_CACHE="textperfect-static-v1",STATIC_ASSETS=["/","/manifest.json","/offline.html"];async function syncOfflineData(){try{console.log("Syncing offline data...")}catch(e){console.error("Sync failed:",e)}}self.addEventListener("install",e=>{console.log("Service Worker installing..."),e.waitUntil(caches.open(STATIC_CACHE).then(e=>(console.log("Caching static assets"),e.addAll(STATIC_ASSETS))).then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{console.log("Service Worker activating..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==CACHE_NAME&&e!==API_CACHE&&e!==STATIC_CACHE)return console.log("Deleting old cache:",e),caches.delete(e)}))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{const{request:t}=e;new URL(t.url).pathname.startsWith("/.netlify/functions/")?e.respondWith(fetch(t).then(e=>{if(200===e.status){const n=e.clone();caches.open(API_CACHE).then(e=>{e.put(t,n)})}return e}).catch(()=>caches.match(t))):"navigate"!==t.mode?e.respondWith(caches.match(t).then(e=>e||fetch(t).then(e=>{if(200===e.status){const n=e.clone();caches.open(STATIC_CACHE).then(e=>{e.put(t,n)})}return e}))):e.respondWith(fetch(t).catch(()=>caches.match("/offline.html")))}),self.addEventListener("sync",e=>{"background-sync"===e.tag&&(console.log("Background sync triggered"),e.waitUntil(syncOfflineData()))}),self.addEventListener("push",e=>{const t={body:e.data?e.data.text():"TextPerfect 알림",icon:"/logo192.png",badge:"/logo192.png",vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primaryKey:1},actions:[{action:"explore",title:"확인하기",icon:"/logo192.png"},{action:"close",title:"닫기"}]};e.waitUntil(self.registration.showNotification("TextPerfect",t))}),self.addEventListener("notificationclick",e=>{e.notification.close(),"explore"===e.action&&e.waitUntil(clients.openWindow("/"))});